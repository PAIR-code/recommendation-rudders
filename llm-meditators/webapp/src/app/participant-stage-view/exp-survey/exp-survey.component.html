<!-- eslint-disable @angular-eslint/template/interactive-supports-focus -->
<!-- eslint-disable @angular-eslint/template/click-events-have-key-events -->
<div class="main">
  @for (question of stageData.questions; track question; let questionIdx = $index) {
    @if (question.itemRatings) {
      <h2>Item rating</h2>
      <!-- Rating Items -->
      @for (itemPair of question.itemRatings.ratings; track $index) {
        <div class="item-pair">
          <div class="title">Please rate the following pair of items:</div>
          <div class="item-pair-displays">
            <div
              class="item-pair-item {{ itemPair.choice === 'item1' ? 'selected' : '' }}"
              (click)="setChoice(questionIdx, $index, 'item1')"
            >
              <img src="{{ itemPair.item1.imageUrl }}" alt="{{ itemPair.item1.name }}" />
              <span class="item-pair-item-name">{{ itemPair.item1.name }}</span>
            </div>
            <div
              class="item-pair-item {{ itemPair.choice === 'item2' ? 'selected' : '' }}"
              (click)="setChoice(questionIdx, $index, 'item2')"
            >
              <img src="{{ itemPair.item2.imageUrl }}" alt="{{ itemPair.item2.name }}" />
              <span class="item-pair-item-name">{{ itemPair.item2.name }}</span>
            </div>
          </div>

          @if (itemPair.choice !== null) {
            <div class="item-pair-confidence">
              <div class="confidence-value">
                <strong>Confidence:</strong>
                <span class="value {{ itemPair.confidence === null ? 'not-rated' : '' }}">
                  {{ itemPair.confidence !== null ? itemPair.confidence.toFixed(1) : 'Not rated' }}
                </span>
              </div>
              <div class="slider-container">
                @if (itemPair.confidence === 0 || itemPair.confidence === null) {
                  <span class="slider-end-label"><b> 50/50 ü§∑</b></span>
                } @else {
                  <span class="slider-end-label">50/50 ü§∑</span>
                }
                <mat-slider min="0" max="1" step="0.1" discrete>
                  <input
                    matSliderThumb
                    (valueChange)="setConfidence(questionIdx, $event, $index)"
                    value="{{ itemPair.confidence }}"
                  />
                </mat-slider>
                @if (itemPair.confidence === 1) {
                  <span class="slider-end-label"
                    >üëç<b> Full <br />confidence</b></span
                  >
                } @else {
                  <span class="slider-end-label">üëç Full <br />confidence</span>
                }
              </div>
            </div>
          }
        </div>
      }
      <p>
        <br />
      </p>
    } @else {
      <!-- Survey -->
      <div>
        <h2 style="white-space: pre-wrap">
          {{ question.questionText }}
        </h2>
      </div>
      <!-- create a slider -->
      <table>
        <tr>
          <td class="bound">{{ question.lowerBound }}</td>
          <td>
            <mat-slider min="0" max="10" step="1" showTickMarks discrete>
              <input matSliderThumb (valueChange)="updateSliderValue($event, questionIdx)" />
            </mat-slider>
          </td>
          <td class="bound">{{ question.upperBound }}</td>
        </tr>
      </table>
      @if (question.openFeedback) {
        <form class="settings-form">
          <mat-form-field class="full-width">
            <mat-label>Answer</mat-label>
            <input
              matInput
              placeholder="Write your response"
              [formControl]="responseControl[questionIdx]"
            />
          </mat-form-field>
        </form>
      }
    }
  }
</div>
